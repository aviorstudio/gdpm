---
export const prerender = false;

import Layout from '../layouts/Layout.astro';
import SupabaseAuth from '../components/SupabaseAuth/index.astro';
import { DebugNow } from '../components/qwik/debugNow/DebugNow';
import { getServerSession, getProfileById } from '../services/supabase';

const { client, session } = await getServerSession(Astro.cookies);
if (client && session) {
	const { exists } = await getProfileById(client, session.user.id);
	Astro.redirect(exists ? '/' : '/onboard');
}
---

<Layout>
	<section class="page">
		<div class="frame">
			<h1 class="title">Godot Plugin Manager</h1>
			<p class="headline">Access your plugin library</p>
			<p class="lede">
				Secure sign in powered by Supabase so you can store, version, and sync your Godot add-ons
				without leaving the manager.
			</p>

			<SupabaseAuth />
			<DebugNow qwik:visible />
		</div>
	</section>

</Layout>
