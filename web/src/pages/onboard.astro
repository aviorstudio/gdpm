---
export const prerender = false;

import Layout from '../layouts/Layout.astro';
import { OnboardForm } from '../components/qwik/onboardForm/OnboardForm';
import { getServerSession, getProfileById } from '../services/supabase';

const { client, session } = await getServerSession(Astro.cookies);
if (!session) {
	Astro.redirect('/signin');
}
if (client && session) {
	const { exists } = await getProfileById(client, session.user.id);
	if (exists) {
		Astro.redirect('/');
	}
}
---

<Layout>
	<section class="page">
		<div class="frame">
			<h1 class="title">Finish setup</h1>
			<p class="headline">Add your username</p>
			<p class="lede">
				We found your account but still need a username to link your profile for the Godot Plugin
				Manager.
			</p>

			<OnboardForm qwik:visible />
		</div>
	</section>
</Layout>
