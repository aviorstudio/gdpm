---
export const prerender = false;

import Layout from '../layouts/Layout.astro';
import { SignOutButton } from '../components/qwik/signOutButton/SignOutButton';
import { getServerSession, readSessionFromCookies } from '../services/supabase';

const earlySession = readSessionFromCookies(Astro.cookies);
if (!earlySession) {
	return Astro.redirect('/signin');
}

const { session } = await getServerSession(Astro.cookies);
if (!session) {
	return Astro.redirect('/signin');
}

const email = session.user?.email ?? 'Signed in';

---

<Layout>
	<section class="page">
		<div class="frame">
			<h1 class="title">Godot Plugin Manager</h1>
			<p class="headline">Welcome back</p>
			<p class="lede">
				Youâ€™re signed in. Manage, version, and sync your Godot add-ons without leaving the manager.
			</p>

			<div class="card main">
				<div class="main-header">
					<p class="eyebrow">Account</p>
					<p class="signed-email">{email}</p>
				</div>
				<p class="main-copy">
					Keep your plugins in sync across projects. Use the sign-in page if you need to start a new
					session.
				</p>
				<SignOutButton qwik:visible />
			</div>
		</div>
	</section>
</Layout>
