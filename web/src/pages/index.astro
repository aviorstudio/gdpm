---
export const prerender = false;

import RootLayout from '../layouts/RootLayout.astro';
import { getServerSession, readSessionFromCookies } from '../services/supabase';

const earlySession = readSessionFromCookies(Astro.cookies);
if (!earlySession) {
	return Astro.redirect('/signin');
}

const { session } = await getServerSession(Astro.cookies);
if (!session) {
	return Astro.redirect('/signin');
}

const email = session.user?.email ?? 'Signed in';

---

<RootLayout>
	<section class="flex justify-center px-4 py-12 md:py-16">
		<div class="w-full max-w-3xl space-y-6">
			<div class="space-y-3 text-center">
				<h1 class="text-3xl font-semibold tracking-tight text-slate-900 md:text-4xl">
					Godot Plugin Manager
				</h1>
				<p class="text-lg font-semibold text-slate-900">Welcome back</p>
				<p class="mx-auto max-w-3xl text-base text-slate-600">
					Youâ€™re signed in. Manage, version, and sync your Godot add-ons without leaving the manager.
				</p>
			</div>

			<div class="w-full space-y-4 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
				<div class="flex flex-col gap-1">
					<p class="text-xs font-semibold uppercase tracking-[0.12em] text-sky-600">Account</p>
					<p class="text-sm text-slate-600">{email}</p>
				</div>
				<p class="text-base leading-relaxed text-slate-600">
					Keep your plugins in sync across projects. Use the sign-in page if you need to start a new
					session.
				</p>
				<form class="flex justify-end" method="post" action="/signout">
					<button
						class="inline-flex items-center justify-center rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm font-semibold text-slate-800 shadow-sm transition hover:bg-slate-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-slate-400"
						type="submit"
					>
						Sign out
					</button>
				</form>
			</div>
		</div>
	</section>
</RootLayout>
