---
export const prerender = false;

import AuthLayout from '../layouts/AuthLayout.astro';
import AuthInput from '../components/AuthInput.astro';
import { readSessionFromCookies } from '../services/supabase';

const earlySession = readSessionFromCookies(Astro.cookies);
if (earlySession) {
  return Astro.redirect('/');
}

if (Astro.request.method === 'POST') {
  return new Response(null, { status: 307, headers: { Location: '/api/signup' } });
}

const search = Astro.url.searchParams;
const status = search.get('status') ?? '';
const toneParam = search.get('tone');
const tone: 'muted' | 'error' | 'success' =
  toneParam === 'error' ? 'error' : toneParam === 'success' ? 'success' : 'muted';
---

<AuthLayout status={status} tone={tone} mode="signup">
  <AuthInput
    label="Username"
    name="username"
    autocomplete="username"
    minlength="3"
    maxlength="32"
  />

  <AuthInput label="Email" name="email" type="email" autocomplete="email" />

  <AuthInput
    label="Password"
    name="password"
    type="password"
    minlength="6"
    autocomplete="new-password"
  />
</AuthLayout>
